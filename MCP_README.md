# MCP文件系统集成说明

## 概述
本日历应用已集成MCP（Model Context Protocol）文件系统功能，允许AI助手通过自然语言命令直接操作本地文件和日历数据。

## ✅ 功能特性

### 📁 文件系统操作
- **列出目录**: 查看指定目录的内容和结构
- **查看文件**: 读取文本文件内容
- **写入文件**: 创建新文件或修改现有文件
- **搜索文件**: 根据通配符模式搜索文件
- **文件信息**: 获取文件详细属性（大小、修改时间等）

### 📅 日历管理
- **查询日历**: 获取日历数据库统计信息
- **添加提醒**: 创建新的提醒事项
- **列出提醒**: 查看所有提醒列表
- **添加标签**: 创建新的颜色标签
- **列出标签**: 查看所有标签分类

## 🚀 使用方法

### 📋 文件操作命令
```
列出目录: [目录路径]
查看文件: [文件路径]
写入文件: [文件路径]
[文件内容]
搜索文件: [搜索模式]
文件信息: [文件路径]
```

### 📋 日历操作命令
```
查询日历
添加提醒: [标题]
[日期时间格式: YYYY-MM-DD HH:MM]
列出提醒
添加标签: [标签名称]
[颜色名称或代码]
列出标签
```

### 🎯 实际使用示例
```
列出目录: .
查看文件: README.md
搜索文件: *.py
文件信息: calendar_app.py
添加提醒: 项目会议 2024-08-20 14:30
添加标签: 工作 蓝色
```

## 🔧 技术实现

### 🏗️ 架构设计
- **MCPManager**: 统一的MCP接口管理器，提供同步API
- **SimpleMCPWrapper**: 简化版MCP实现，基于Python标准库
- **MCPAsyncRunner**: 异步MCP客户端（预留高级功能接口）

### 🛡️ 安全特性
- 路径验证和规范化
- 文件类型白名单检查
- 敏感目录访问限制
- 操作权限验证

### ⚡ 性能优化
- 缓存常用文件信息
- 异步I/O操作
- 错误重试机制
- 内存使用优化

## 📦 安装与启动

### 1. 依赖安装
```bash
pip install -r requirements.txt
```

### 2. 启动应用
```bash
python calendar_app.py
```

### 3. 验证MCP功能
启动后查看聊天窗口左下角，应显示"MCP: 已启用"的绿色标签。

## 🔍 故障排除

### ❗ 常见问题及解决方案

#### 1. MCP服务启动失败
**症状**: 显示"MCP: 未启用"
**解决**: 
- 检查Python环境是否正确
- 确认所有依赖已安装
- 查看控制台错误信息

#### 2. 文件操作无响应
**症状**: 文件命令无返回结果
**解决**:
- 确认文件路径存在
- 检查文件权限
- 尝试使用相对路径

#### 3. 数据库连接错误
**症状**: 日历查询失败
**解决**:
- 检查calendar_data.db文件权限
- 确认数据库完整性
- 重启应用

### 📊 调试信息查看
- **控制台输出**: 实时查看MCP服务状态
- **日志文件**: 详细操作记录
- **错误提示**: 用户友好的错误消息

## 🔐 安全最佳实践

### 📋 使用建议
- ✅ 使用相对路径避免权限问题
- ✅ 定期备份重要文件
- ✅ 避免操作系统敏感目录
- ✅ 限制文件操作范围

### ⚠️ 注意事项
- ❌ 不要删除系统关键文件
- ❌ 避免在根目录执行操作
- ❌ 谨慎处理可执行文件
- ❌ 定期清理临时文件

## 🔄 版本更新

### 当前版本: v1.0.0
- ✅ 基础文件操作
- ✅ 日历数据管理
- ✅ 错误处理机制
- ✅ 用户友好界面

### 未来计划
- 🔄 支持更多文件类型
- 🔄 批量操作功能
- 🔄 文件版本控制
- 🔄 高级搜索功能

## 📞 技术支持
如遇到问题，请检查：
1. 应用左下角MCP状态显示
2. 控制台错误信息
3. 文件和目录权限
4. 网络连接状态